#!/bin/sh
# Bootstrap script - run this on a fresh system
# Usage: ./setup

set -e

DOTFILES_DIR="$(cd "$(dirname "$0")" && pwd)"

printf "\033[34mðŸš€ Dotfiles Bootstrap\033[0m\n"

# Check if we have cargo/rust already
if ! command -v cargo >/dev/null 2>&1; then
  printf "\033[33mâ†’ Rust not found, installing rustup...\033[0m\n"
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain stable
  . "$HOME/.cargo/env"
  printf "\033[32mâœ“ Rust installed\033[0m\n"
fi

# Build all binaries
printf "\033[35mâ†’ Building Rust binaries...\033[0m\n"
cd "$DOTFILES_DIR/crates"
cargo build --release --bins

# Copy binaries to bin/
mkdir -p "$DOTFILES_DIR/bin"
find target/release -maxdepth 1 -type f -executable ! -name "*.*" ! -name ".*" -exec cp {} "$DOTFILES_DIR/bin/" \;

printf "\033[32mâœ“ Binaries built and installed to ~/.dotfiles/bin\033[0m\n"
printf "\033[36m\nâ†’ Run 'upd' to complete setup\033[0m\n"
