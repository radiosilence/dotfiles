#!/bin/sh
set -eu

BITRATE="${BITRATE:-160}"
DIR="${1:-.}"

echo "Bitrate: $BITRATE kbps"
echo "Dir: $DIR"

find "$DIR" -type f \( -name "*.wav" -o -name "*.aiff" -o -name "*.flac" -o -name "*.m4a" \) -exec ffmpeg -i {} -c:a libopus -b:a "$BITRATE"k "{}.opus" \; -exec rm {} \;
